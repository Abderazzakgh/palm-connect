# ๐ ุฏููู ุงูุชุทุจูู ุงููุงูู - ูู ุงูุฃูู ุฅูู ุงูุฃุฎูุฑ

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. โ Supabase Edge Functions
- โ `handshake` - ุชุจุงุฏู ููุงุชูุญ ECDH
- โ `vein-upload` - ุฑูุน ุงูุตูุฑ ุงููุดูุฑุฉ (ุจุณูุท)
- โ `vein-secure-upload` - ุฑูุน ุขูู ูุน ECDH + HKDF + AES-GCM
- โ **ุชุญุฏูุซ:** ุฌููุน Functions ุชุฎุฒู ุงูุตูุฑ ุงููุดูุฑุฉ ูู Supabase Storage

### 2. โ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ `handshakes` - ุจูุงูุงุช handshake
- โ `palm_vein_data` - ุจูุงูุงุช ุจุตูุฉ ุงููู ุงููุดูุฑุฉ
- โ `server_keys` - ููุงุชูุญ ุงูุฎุงุฏู
- โ `palm_prints` - ุจุตูุงุช ุงููู (ูุญุฏุซ)

### 3. โ Supabase Storage
- โ `encrypted_palm_data` - bucket ุฎุงุต ููุจูุงูุงุช ุงููุดูุฑุฉ (ุฎุงุต)
- โ `palm_scans` - bucket ููุตูุฑ ุงูุนุงูุฉ (ุนุงู)

### 4. โ ุงูููุฏ
- โ `CompleteProfile.tsx` - ูุญุฏุซ ูุฅุฑุณุงู ุงูุตูุฑ ุงููุดูุฑุฉ ุจุดูู ุตุญูุญ
- โ `Scanner.tsx` - ูุญุฏุซ ููุตุญุญ
- โ ุฌููุน ุงูุฃุฎุทุงุก ุชู ุฅุตูุงุญูุง

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู ุงููุงููุฉ

### ุงููุฑุญูุฉ 1: ุฅุนุฏุงุฏ Supabase (ุฅูุฒุงูู)

#### 1.1 ุชุทุจูู Migrations

**ูู Supabase Dashboard:**

1. ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
2. ุงุฎุชุฑ ูุดุฑูุนู: **qxtdcqwhqfuhlhwoffem**
3. **SQL Editor** โ **New Query**

**ูู ุจุชุทุจูู ุงููููุงุช ุจุงูุชุฑุชูุจ:**

```sql
-- 1. ุงููููุงุช ุงูุฃุณุงุณูุฉ (ุฅุฐุง ูู ุชูู ูุทุจูุฉ)
-- 20251106011503_9c95fabf-9c8c-453a-a924-34bf95c80cbb.sql
-- 20251106011514_b0171131-16e5-41ee-bdd3-7455087c281c.sql
-- 20251106012753_5e38d36b-f035-4877-9315-52f9037c3095.sql
-- 20251106020000_add_matched_user_id.sql

-- 2. ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ
supabase/migrations/20251106030000_create_handshakes_table.sql

-- 3. RLS Policies
supabase/migrations/20251106040000_setup_rls_policies.sql

-- 4. ุชุญุฏูุซ palm_prints
supabase/migrations/20251106050000_update_palm_prints_status_enum.sql

-- 5. ุฅุนุฏุงุฏ Storage
supabase/migrations/20251106060000_setup_storage.sql
```

**ุฃู ุงุณุชุฎุฏู ุงูููู ุงูููุญุฏ:**
- ุงูุชุญ `supabase/APPLY_ALL_MIGRATIONS.sql`
- ุงูุณุฎ ูู ุงููุญุชูู ูุงูุตูู ูู SQL Editor
- ุงุถุบุท **Run**

#### 1.2 ุงูุชุญูู ูู Storage Buckets

1. **Storage** โ **Buckets**
2. ูุฌุจ ุฃู ุชุฑู:
   - โ `encrypted_palm_data` (ุฎุงุต)
   - โ `palm_scans` (ุนุงู)

ุฅุฐุง ูู ุชูู ููุฌูุฏุฉุ ูู ุจุชุดุบูู migration `20251106060000_setup_storage.sql`

---

### ุงููุฑุญูุฉ 2: ูุดุฑ Edge Functions (ุฅูุฒุงูู)

#### 2.1 ูู Supabase Dashboard

1. **Edge Functions** โ **Create a new function**

**Function 1: handshake**
- ุงูุงุณู: `handshake`
- ุงูุณุฎ ูุญุชูู: `supabase/functions/handshake/index.ts`
- **Deploy**

**Function 2: vein-upload**
- ุงูุงุณู: `vein-upload`
- ุงูุณุฎ ูุญุชูู: `supabase/functions/vein-upload/index.ts`
- **Deploy**

**Function 3: vein-secure-upload**
- ุงูุงุณู: `vein-secure-upload`
- ุงูุณุฎ ูุญุชูู: `supabase/functions/vein-secure-upload/index.ts`
- **Deploy**

#### 2.2 ุงูุชุญูู ูู ุงููุดุฑ

- ูุฌุจ ุฃู ุชุฑู 3 functions ูู ุงููุงุฆูุฉ
- ุงุถุบุท ุนูู ูู function โ **Logs** ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก

---

### ุงููุฑุญูุฉ 3: ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ (ุฅูุฒุงูู)

#### 3.1 ุฅูุดุงุก ููู `.env`

ูู ุงููุฌูุฏ ุงูุฑุฆูุณู ูููุดุฑูุน:

```env
VITE_SUPABASE_URL=https://qxtdcqwhqfuhlhwoffem.supabase.co
VITE_SUPABASE_PUBLISHABLE_KEY=your_anon_key_here
```

#### 3.2 ุงูุญุตูู ุนูู Anon Key

1. Supabase Dashboard โ **Settings** โ **API**
2. ุงูุณุฎ `anon` `public` key
3. ุงูุตูู ูู `.env`

---

### ุงููุฑุญูุฉ 4: ุงุฎุชุจุงุฑ ุงูุชุทุจูู

#### 4.1 ุชุดุบูู ุงูุชุทุจูู

```bash
npm run dev
```

#### 4.2 ุงุฎุชุจุงุฑ Complete Profile

1. ุงูุชุญ: http://localhost:5173
2. ุงุฐูุจ ุฅูู ุตูุญุฉ **Complete Profile**
3. **ุงูุชูุท ุตูุฑุฉ** ูู ุงููุงููุฑุง
4. **ุชุดููุฑ (ูุญูู)** - ููุชุดููุฑ ุงูุจุณูุท
5. **ุฅุฑุณุงู ุฅูู ุงูุฎุงุฏู** - ููุฑูุน ุงูุจุณูุท
6. ุฃู **ุฅุฑุณุงู ุขูู (ECDH)** - ููุฑูุน ุงูุขูู

#### 4.3 ุงูุชุญูู ูู ุงููุฌุงุญ

**ูู Supabase Dashboard:**

1. **Table Editor** โ `palm_vein_data`
   - ูุฌุจ ุฃู ุชุฑู ุณุฌูุงู ุฌุฏูุฏุงู
   - `storage_path` ูุฌุจ ุฃู ูุญุชูู ุนูู ูุณุงุฑ ุงูููู

2. **Storage** โ `encrypted_palm_data`
   - ูุฌุจ ุฃู ุชุฑู ููู `.enc` ุฌุฏูุฏ

3. **Edge Functions** โ **Logs**
   - ูุฌุจ ุฃู ุชุฑู ุทูุจุงุช ูุงุฌุญุฉ (200)

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: "bucket does not exist"

**ุงูุญู:**
```sql
-- ูู ุจุชุดุบูู migration Storage
-- supabase/migrations/20251106060000_setup_storage.sql
```

### ูุดููุฉ: "Edge Function not found"

**ุงูุญู:**
- ุชุฃูุฏ ูู ูุดุฑ ุฌููุน Functions
- ุชุญูู ูู ุงูุฃุณูุงุก: `handshake`, `vein-upload`, `vein-secure-upload`

### ูุดููุฉ: "CORS error"

**ุงูุญู:**
- ุชุญูู ูู `Authorization` header
- ุชุฃูุฏ ูู ุฃู URL ุตุญูุญ
- ุชุญูู ูู `VITE_SUPABASE_URL` ูู `.env`

### ูุดููุฉ: "permission denied"

**ุงูุญู:**
- ุชุญูู ูู RLS Policies
- ุชุฃูุฏ ูู ุชุทุจูู migration RLS
- ุชุญูู ูู Storage Policies

---

## ๐ ุงูุจููุฉ ุงูููุงุฆูุฉ

```
Supabase
โโโ Database
โ   โโโ handshakes          โ
โ   โโโ palm_vein_data     โ
โ   โโโ server_keys         โ
โ   โโโ palm_prints        โ (ูุญุฏุซ)
โ
โโโ Storage
โ   โโโ encrypted_palm_data โ (ุฎุงุต - ููุจูุงูุงุช ุงููุดูุฑุฉ)
โ   โโโ palm_scans          โ (ุนุงู - ููุตูุฑ)
โ
โโโ Edge Functions
    โโโ handshake           โ
    โโโ vein-upload         โ
    โโโ vein-secure-upload  โ
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

- [ ] ุชุทุจูู ุฌููุน Migrations
- [ ] ุฅูุดุงุก Storage Buckets
- [ ] ูุดุฑ ุฌููุน Edge Functions
- [ ] ุฅุนุฏุงุฏ `.env` ูุน ุงููุชุบูุฑุงุช ุงูุตุญูุญุฉ
- [ ] ุงุฎุชุจุงุฑ Complete Profile
- [ ] ุงูุชุญูู ูู Storage (ูุฌุจ ุฃู ุชุฑู ูููุงุช `.enc`)
- [ ] ุงูุชุญูู ูู Database (ูุฌุจ ุฃู ุชุฑู ุณุฌูุงุช ูู `palm_vein_data`)
- [ ] ุงูุชุญูู ูู Logs (ูุฌุจ ุฃู ุชุฑู ุทูุจุงุช ูุงุฌุญุฉ)

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุจุนุฏ ุชุทุจูู ุฌููุน ุงูุฎุทูุงุช:

1. โ **ุงูุตูุฑ ุงููุดูุฑุฉ** ุชูุฑุณู ุฅูู Supabase Storage
2. โ **ุงูุจูุงูุงุช ุงููุดูุฑุฉ** ุชูุฎุฒู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. โ **Handshake** ูุนูู ุจุดูู ุตุญูุญ
4. โ **ุงูุฑูุน ุงูุขูู** ูุนูู ูุน ECDH + HKDF + AES-GCM
5. โ **ุฌููุน ุงููุตูุงุช** ุชุนูู ุจุดูู ุตุญูุญ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ุงูุฃูุงู
- ุงูุจูุงูุงุช ุงููุดูุฑุฉ ุชูุฎุฒู ูู bucket ุฎุงุต (`encrypted_palm_data`)
- ุงูููุชุงุญ ุงูุฎุงุต ููุฎุงุฏู ูุฎุฒู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ููุฅูุชุงุฌ: ุงุณุชุฎุฏู Supabase Secrets)
- RLS Policies ููุนูุฉ ุนูู ุฌููุน ุงูุฌุฏุงูู

### ุงูุฃุฏุงุก
- ุงูุตูุฑ ุงููุดูุฑุฉ ูุจูุฑุฉ ุงูุญุฌูุ ูุฐุง ูุชู ุชุฎุฒูููุง ูู Storage ูููุณ ูู Database
- ูุชู ุชุฎุฒูู ุฃูู 100 ุญุฑู ููุท ูู Database ูู metadata

### ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)
- ุฑุจุท Algorithm Service ุงููุนูู
- ุชุญุณูู ุงูุฃูุงู (ุชุดููุฑ ุงูููุชุงุญ ุงูุฎุงุต)
- ุฅุถุงูุฉ ูุนุงูุฌุฉ ููุฃุฎุทุงุก ุจุดูู ุฃูุถู

---

**๐ ุงูุชุทุจูู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

ุจุนุฏ ุชุทุจูู ุฌููุน ุงูุฎุทูุงุชุ ุณูุนูู ุงูุชุทุจูู ุจุงููุงูู ูุน Supabase!

